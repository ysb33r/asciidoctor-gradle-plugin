// tag::use-gems[]
plugins {
    id 'org.asciidoctor.jvm.convert'
    id 'org.asciidoctor.jvm.gems'
    id 'org.ysb33r.os' version '0.9'
}
// end::use-gems[]

apply from: "${System.getProperty('OFFLINE_REPO')}/repositories.gradle"

// tag::use-gems[]
repositories {
    maven { url 'http://rubygems-proxy.torquebox.org/releases' } // <2>
}

dependencies {
    asciidoctorGems 'rubygems:asciidoctor-bibtex:0.3.1'
}

asciidoctorj {
    requires 'asciidoctor-bibtex'
    jrubyVersion '9.2.1.0'
}

asciidoctor {
    dependsOn asciidoctorGemsPrepare

    secondarySources {
        include 'biblio.bib'
    }

    attributes 'bibtex-file' : file("${sourceDir}/biblio.bib")
}
// end::use-gems[]

task runGradleTest {

    if(OS.windows) {
        doLast {
            println '***** The external GEMs test is currently disabled on Windows *****'
        }
    } else {
        dependsOn asciidoctor
    }git
}

